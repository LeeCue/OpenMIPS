## PC模块

- pc模块的作用是给出指令地址，其接口描述如表所示

| 序号 |  接口名  | 宽度（bit） | 输入/输出 |          作用          |
| :--: | :------: | :---------: | :-------: | :--------------------: |
|  1   |   rst    |      1      |   输入    |        复位信号        |
|  2   |   clk    |      1      |   输入    |        时钟信号        |
|  3   |   pc_i   |     32      |   输入    |     修改的指令地址     |
|  4   | branch_i |      1      |   输入    |    是否发生地址转移    |
|  5   |  stall   |      6      |   输入    | 来自控制模块，暂停信号 |
|  6   |    pc    |     32      |   输出    |    要读取的指令地址    |
|  7   |    ce    |      1      |   输出    |   指令存储器使能信号   |

​		当输入的rst为高电平时，表示复位信号有效。

​		在复位的时候，输出的指令存储器使能信号为ChipDisable，表示指令存储器禁用，其余时刻指令存储器使能信号为ChipEnable，表示指令存储器使能。

​		在指令存储器禁用时，PC的值保持为0，当指令存储器能使用时，PC的值会在每时钟加4，表示下一条的指令地址，因为一条指令是32位的，一条指令对应4个字节，所以PC加4指向下一条指令地址。

---

## IF/ID模块

- IF/ID模块的作用是暂时保存取指阶段取得的指令，以及对应的指令地址，并在下一个时钟传递到译码阶段，其接口描述如表所示

| 序号 | 接口名  | 宽度（bit） | 输入/输出 |             作用             |
| :--: | :-----: | :---------: | :-------: | :--------------------------: |
|  1   |   rst   |      1      |   输入    |           复位信号           |
|  2   |   clk   |      1      |   输入    |           时钟信号           |
|  3   |  if_pc  |     32      |   输入    | 取值阶段取得的指令对应的地址 |
|  4   | if_inst |     32      |   输入    |      取值阶段取得的指令      |
|  5   |  stall  |      6      |   输入    |    来自控制模块，暂停信号    |
|  6   |  id_pc  |     32      |   输出    |   译码阶段的指令对应的地址   |
|  7   | id_inst |     32      |   输出    |        译码阶段的指令        |

​		IF/ID模块只是简单地将取指阶段的结果在每个时钟周期的上升沿传递到译码阶段。

---

## Regfile模块

- Regfile模块实现了32个32位通用整数寄存器，可以同时进行两个寄存器的读操作和一个寄存器的写操作，其接口描述如表所示

| 序号 | 接口名 | 宽度（bit） | 输入/输出 |                  作用                  |
| :--: | :----: | :---------: | :-------: | :------------------------------------: |
|  1   |  rst   |      1      |   输入    |          复位信号，高电平有效          |
|  2   |  clk   |      1      |   输入    |                时钟信号                |
|  3   | waddr  |      5      |   输入    |           要写入的寄存器地址           |
|  4   | wdata  |     32      |   输入    |              要写入的数据              |
|  5   |   we   |      1      |   输入    |               写使能信号               |
|  6   | raddr1 |      5      |   输入    | 第一个读寄存器端口要读取的寄存器的地址 |
|  7   |  re1   |      1      |   输入    |      第一个读寄存器端口度使能信号      |
|  8   | rdata1 |     32      |   输出    |      第一个读寄存器端口读使能信号      |
|  9   | raddr2 |      5      |   输入    | 第二个读寄存器端口要读取的寄存器的地址 |
|  10  |  re2   |      1      |   输入    |      第二个读寄存器端口读使能信号      |
|  11  | rdata2 |     32      |   输出    |    第二个读寄存器端口输出的寄存器值    |

​		Regfile模块可以分为四段。

1. 第一段：定义了一个二维的向量，元素个数是32，每个元素的宽度是32。此处定义了一个32个32位寄存器。

    		2. 第二段：实现了写寄存器操作，当复位信号无效时，在写使能信号有效，且写操作目的寄存器不等于0的情况下，可以将写输入数据保存到目的寄存器。之所以要判断目的寄存器不为0，是因为MIPS32架构规定$0的值只能为0，所以不要写入。
          		3. 第三段：实现了第一个读寄存器端口，分以下几步依次判断：
      
       - 当复位信号有效时，第一个读寄存器端口的输出始终为0；
       - 当复位信号有效时，如果读取读的是$0，那么直接给出0；
       - 如果第一个读寄存器端口要读取的目的寄存器与要写入的目的寄存器是同一个寄存器，那么直接将要写入的值作为第一个读寄存器端口的输出；
       - 如果以上情况都不满足，那么给出第一个读寄存器端口要读取的目的寄存器地址对应寄存器的值；
	    - 第一个读寄存器端口不能使用时，直接输出0。
	    4. 第四段：实现了第二个读寄存器端口，具体过程与第三段是相似的。

==注意==：读寄存器操作时组合逻辑电路，也就是一旦输入的要读取的寄存器地址raddr1或者raddr2,发生变化，那么会立即给出新地址对应的寄存器的值，这样可以保证在译码阶段取得要读取的寄存器的值，而在写寄存器操作是时序逻辑电路，写操作发生在时钟信号的上升沿。

---

## ID模块

- ID模块的作用是对指令进行译码，得到最终的指令类型、子类型、源操作数1、第二个操作数选择信息、要写入的目的寄存器地址等信息。其中指令类型指的是存取数类型、R-type、beq，子类型指的是更加详细的运算类型，比如：当运算类型是逻辑运算时，运算子类型可以是逻辑“或”运算，逻辑“与”运算等。ID模块的接口描述如表所示

| 序号 |   接口名    | 宽度（bit） | 输入/输出 |                    作用                     |
| :--: | :---------: | :---------: | :-------: | :-----------------------------------------: |
|  1   |     rst     |      1      |   输入    |                  复位信号                   |
|  2   |    pc_i     |     32      |   输入    |          译码阶段的指令对应的地址           |
|  3   |   inst_i    |     32      |   输入    |               译码阶段的指令                |
|  4   | reg1_data_i |     32      |   输入    |   从Regfile输入的第一个读寄存器端口的输入   |
|  5   | reg2_data_i |     32      |   输入    |   从Regfile输入的第二个读寄存器端口的输入   |
|  6   |  ex_wreg_i  |      1      |   输入    |    处于执行阶段的指令是否要写目的寄存器     |
|  7   |   ex_wd_i   |      5      |   输入    |   处于执行阶段的指令要写的目的寄存器地址    |
|  8   | ex_wdata_i  |     32      |   输入    | 处于执行阶段的指令要写入的目的寄存器的数据  |
|  9   | mem_wreg_i  |      1      |   输入    |    处于访存阶段的指令是否要写目的寄存器     |
|  10  |  mem_wd_i   |      5      |   输入    |   处于访存阶段的指令要写的目的寄存器地址    |
|  11  | mem_wdata_i |     32      |   输入    | 处于访存阶段的指令要写入的目的寄存器的数据  |
|  12  | reg1_read_o |      1      |   输出    | Regfile模块的第一个读寄存器端口的读使能信号 |
|  13  | reg2_read_o |      1      |   输出    | Regfile模块的第二个读寄存器端口的读使能信号 |
|  14  | reg1_addr_o |      5      |   输出    | Regfile模块的第一个读寄存器端口的读地址信号 |
|  15  | reg2_addr_o |      5      |   输出    | Regfile模块的第二个读寄存器端口的读地址信号 |
|  16  |   aluop_o   |      2      |   输出    |          译码阶段要进行的指令类型           |
|  17  |  alusel_o   |      4      |   输出    |      译码阶段要进行的指令具体运算类型       |
|  18  |   reg1_o    |     32      |   输出    |            端口一读出寄存器的值             |
|  19  |   reg2_o    |     32      |   输出    |            端口二读出寄存器的值             |
|  20  |    wd_o     |      5      |   输出    |          要写入的目的寄存器的地址           |
|  21  |   wreg_o    |      1      |   输出    |            是否要写入目的寄存器             |
|  22  |  alusrc_o   |      1      |   输出    |      端口二寄存器的值与立即数选择信号       |
|  23  |  immediate  |     32      |   输出    |               扩展后的立即数                |
|  24  |   memW_o    |      1      |   输出    |             数据存储单元写使能              |
|  25  |   memR_o    |      1      |   输出    |             数据存储单元读使能              |
|  26  |  branch_o   |      1      |   输出    |              是否发生地址转移               |
|  27  |    pc_o     |     32      |   输出    |              修改后的指令地址               |
|  28  |    in_o     |      1      |   输出    |          是否需要从IN单元读取数字           |
|  29  |    out_o    |      1      |   输出    |        是否将寄存器的数输出到OUT单元        |

​		ID模块中的电路都是组合逻辑电路，ID模块与Regfile模块也有接口连接。ID模块可分为三段。

1. 第一段：实现了对指令的译码，依据指令中的特征字段区分指令。
2. 第二段：读出端口一读出的寄存器值。
3. 第三段：读出端口二读出的寄存器值。

---

## ID/EX模块

- ID模块的输出连接到ID/EX模块，后者的作用是将译码阶段取得的运算类型、源操作数、要写的目的寄存器地址等结果，在下一个始终传递到流水线执行阶段。其接口描述如表所示。

| 序号 |  接口名   | 宽度（bit） | 输入/输出 |                  作用                  |
| :--: | :-------: | :---------: | :-------: | :------------------------------------: |
|  1   |    rst    |      1      |   输入    |                复位信号                |
|  2   |    clk    |      1      |   输入    |                时钟信号                |
|  3   | id_alusel |      4      |   输入    |    译码阶段要进行的指令具体运算类型    |
|  4   | id_aluop  |      2      |   输入    |        译码阶段要进行的指令类型        |
|  5   |  id_reg1  |     32      |   输入    |          端口一读出寄存器的值          |
|  6   |  id_reg2  |     32      |   输入    |          端口二读出寄存器的值          |
|  7   |   id_wd   |      5      |   输入    |  译码阶段的指令要写入的目的寄存器地址  |
|  8   |  id_wreg  |      1      |   输入    | 译码阶段的指令是否又要写入的目的寄存器 |
|  9   | id_alusrc |      1      |   输入    |      译码阶段第二个操作数选择信号      |
|  10  |  id_imm   |     32      |   输入    |       译码阶段产生的扩展后立即数       |
|  11  |  id_memW  |      1      |   输入    |   译码阶段的指令是否有要写入存储单元   |
|  12  |  id_memR  |      1      |   输入    |    译码阶段的指令是否有要读存储单元    |
|  13  |   id_in   |      1      |   输入    |       译码阶段的指令是否读IN单元       |
|  14  |  id_out   |      1      |   输入    |    译码阶段的指令是否写入到OUT单元     |
|  15  |   stall   |      6      |   输入    |      来自控制模块的信息，暂停信号      |
|  16  | ex_alusel |      4      |   输出    |    执行阶段要进行的指令具体运算类型    |
|  17  | ex_aluop  |      2      |   输出    |        执行阶段要进行的指令类型        |
|  18  |  ex_reg1  |     32      |   输出    |          端口一读出寄存器的值          |
|  19  |  ex_reg2  |     32      |   输出    |          端口二读出寄存器的值          |
|  20  |   ex_wd   |      5      |   输出    |  执行阶段的指令要写入的目的寄存器地址  |
|  21  |  ex_wreg  |      1      |   输出    | 执行阶段的指令是否又要写入的目的寄存器 |
|  22  | ex_alusrc |      1      |   输出    |      执行阶段第二个操作数选择信号      |
|  23  |  ex_imm   |     32      |   输出    |       执行阶段产生的扩展后立即数       |
|  24  |  ex_memW  |      1      |   输出    |   执行阶段的指令是否有要写入存储单元   |
|  25  |  ex_memR  |      1      |   输出    |    执行阶段的指令是否有要读存储单元    |
|  26  |   ex_in   |      1      |   输出    |     执行阶段的指令是否有要读IN单元     |
|  27  |  ex_out   |      1      |   输出    |  执行阶段的指令是否有要写入到OUT单元   |

​		ID/EX模块只是简单地将译码阶段的结果在时钟周期上升沿传递到执行阶段。执行阶段将依据这些值进行运算。

---

## EX模块

- EX模块会从ID/EX模块得到运算类型alusel_i、指令类型aluop_i、源操作数reg1_i、源操作数reg2_i、要写入的目的寄存器地址wd_i、alusrc_i、immediate。EX模块会依据这些数据进行运算，其接口描述如表所示。

| 序号 |   接口名   | 宽度（bit） | 输入/输出 |                     作用                     |
| :--: | :--------: | :---------: | :-------: | :------------------------------------------: |
|  1   |    rst     |      1      |   输入    |                   复位信号                   |
|  2   |  alusel_i  |      4      |   输入    |           执行阶段要进行的运算类型           |
|  3   |  aluop_i   |      2      |   输入    |           执行阶段要进行的指令类型           |
|  4   |  alusrc_i  |      1      |   输入    |     执行阶段要进行的第二个操作数选择信号     |
|  5   |   imm_i    |     32      |   输入    |       执行阶段要进行运算的扩展后立即数       |
|  6   |   reg1_i   |     32      |   输入    |             端口一读出寄存器的值             |
|  7   |   reg2_i   |     32      |   输入    |             端口二读出寄存器的值             |
|  8   |    wd_i    |      5      |   输入    |        执行执行要写入的目的寄存器地址        |
|  9   |   wreg_i   |      1      |   输入    |           是否有要写入的目的寄存器           |
|  10  |   memW_i   |      1      |   输入    |              是否要写入存储单元              |
|  11  |   memR_i   |      1      |   输入    |              是否要从存储单元读              |
|  12  |    in_i    |      1      |   输入    |               是否要从IN单元读               |
|  13  |   out_i    |      1      |   输入    |              是否写入到OUT单元               |
|  14  |    wd_o    |      5      |   输出    |   执行阶段的指令最终要写入的目的寄存器地址   |
|  15  |   wreg_o   |      1      |   输出    | 执行阶段的指令最终要是否有要写入的目的寄存器 |
|  16  |  wdata_o   |     32      |   输出    |    执行阶段的指令最终要写入目的寄存器的值    |
|  17  |   memW_o   |      1      |   输出    |              是否要写入存储单元              |
|  18  |   memR_o   |      1      |   输出    |              是否要从存储单元读              |
|  19  | mem_addr_o |     32      |   输出    |           要访问数据存储器RAM地址            |
|  20  |    in_o    |      1      |   输出    |               是否要从IN单元读               |
|  21  |   out_o    |      1      |   输出    |              是否写入到OUT单元               |

​		EX模块中都是组合逻辑电路，可分为两端理解。

1. 第一段：依据输入的运算子类型进行运算。
2. 第二段：给出最终的运算结果，包括是否要写目的寄存器wreg_o、要写的目的寄存器地址wd_o、要写入的数据wdata_o。其中wreg_o、wd_o的值都直接来自译码阶段，不需要改变，wdata_o的值要依据指令类型以及运算子类型进行选择。

---

## EX/MEM模块

- EX模块的输出连接到EX/MEM模块，后者的作用是将执行阶段取得的运算结果，在下一个时钟传递到流水线访存阶段。其接口描述如表所示。

| 序号 |  接口名   | 宽度（bit） | 输入/输出 |                          作用                          |
| :--: | :-------: | :---------: | :-------: | :----------------------------------------------------: |
|  1   |    rst    |      1      |   输入    |                        复位信号                        |
|  2   |    clk    |      1      |   输入    |                        时钟信号                        |
|  3   |   ex_wd   |      5      |   输入    |       执行阶段的指令执行后要写入的目的寄存器地址       |
|  4   |  ex_wreg  |      1      |   输入    |      执行阶段的指令执行后是否有要写入的目的寄存器      |
|  5   | ex_wdata  |     32      |   输入    | 执行阶段的指令执行后要写入目的寄存器的值或访存单元地址 |
|  6   |  ex_memW  |      1      |   输入    |       执行阶段的指令执行后是否有要写入的存储单元       |
|  7   |  ex_memR  |      1      |   输入    |      执行阶段的指令执行后是否有要从存储单元中读取      |
|  8   |  ex_addr  |     32      |   输入    |           执行阶段执行后要访问的存储单元地址           |
|  9   |   ex_in   |      1      |   输入    |         执行阶段的指令执行后是否要IN单元读取数         |
|  10  |  ex_out   |      1      |   输入    |        执行阶段的指令执行后是否要写入到OUT单元         |
|  11  |   stall   |      6      |   输入    |              来自控制模块的信息，暂停信号              |
|  12  |  mem_wd   |      5      |   输出    |          访存阶段的指令要写入的目的寄存器地址          |
|  13  | mem_wreg  |      1      |   输出    |         访存阶段的指令是否有要写入的目的寄存器         |
|  14  | mem_wdata |     32      |   输出    |    访存阶段的指令要写入目的寄存器的值或访存单元地址    |
|  15  |   mem_W   |      1      |   输出    |               访存阶段是否要写入存储单元               |
|  16  |   mem_R   |      1      |   输出    |              访存阶段是否从存储单元中读取              |
|  17  | mem_addr  |     32      |   输出    |              访存阶段要访问的存储单元地址              |
|  18  |  mem_in   |      1      |   输出    |      访存阶段是否要从IN单元读取，而不是从存储单元      |
|  19  |  mem_out  |      1      |   输出    |      访存阶段是否要写入到OUT单元，而不是存储单元       |

​		EX/MEM模块中，只有一个时序逻辑电路，在时钟上升沿，将执行阶段的结果传递到访存阶段。

---

## MEM模块

- MEM模块的接口描述如表所示

| 序号 |   接口名   | 宽度（bit） | 输入/输出 |                    作用                    |
| :--: | :--------: | :---------: | :-------: | :----------------------------------------: |
|  1   |    rst     |      1      |   输入    |                  复位信号                  |
|  2   |    wd_i    |      5      |   输入    |    访存阶段的指令要写入的目的寄存器地址    |
|  3   |   wreg_i   |      1      |   输入    |   访存阶段的指令是否有要写入的目的寄存器   |
|  4   |  wdata_i   |     32      |   输入    |     访存阶段的指令要写入目的寄存器的值     |
|  5   |   memW_i   |      1      |   输入    |      访存阶段的指令是否要写入存储单元      |
|  6   |   memR_i   |      1      |   输入    |     访存阶段的指令是否要从存储单元中读     |
|  7   | mem_data_i |     32      |   输入    |        来自外部数据存储器RAM的信息         |
|  8   | mem_addr_i |     32      |   输入    |         指令要访问访问存储器的地址         |
|  9   |   mem_in   |      1      |   输入    |    是否要从IN单元读取，而不是从存储单元    |
|  10  |  mem_out   |      1      |   输入    |     是否写入到OUT单元，而不是存储单元      |
|  11  |  data_in   |     32      |   输入    |             来自IN单元输入的数             |
|  12  |    wd_o    |      5      |   输出    | 访存阶段的指令最终要写入的目的寄存器的地址 |
|  13  |   wreg_o   |      1      |   输出    | 访存阶段的指令最终是否有要写入的目的寄存器 |
|  14  |  wdata_o   |     32      |   输出    |   访存阶段的指令最终要写入目的寄存器的值   |
|  15  | mem_addr_o |     32      |   输出    |          要访问的数据存储器的地址          |
|  16  |  mem_we_o  |      1      |   输出    |       是否是写操作，为1表示是写操作        |
|  17  |  mem_re_o  |      1      |   输出    |       是否是读操作，为1表示是读操作        |
|  18  | mem_sel_o  |      4      |   输出    |                字节选择信号                |
|  19  | mem_data_o |     32      |   输出    |           要写入数据存储器的数据           |
|  20  |  mem_ce_o  |      1      |   输出    |             数据存储器使能信号             |
|  21  |  data_out  |     32      |   输出    |             输出到OUT单元的数              |
|  22  |   io_we    |      1      |   输出    |              IO单元写使能信号              |
|  23  |   io_re    |      1      |   输出    |              IO单元读使能信号              |

​		MEM模块中只有一个组合逻辑电路，将输入的执行阶段的结果直接作为输出，MEM模块的输出连接到MEM/WB模块。

---

## MEM/WB模块

- MEM/WB模块的作用是将访存阶段的运算结果，在一个时钟传递到回写阶段，其接口描述如表所示。

| 序号 |  接口名   | 宽度（bit） | 输入/输出 |                   作用                   |
| :--: | :-------: | :---------: | :-------: | :--------------------------------------: |
|  1   |    rst    |      1      |   输入    |                 复位信号                 |
|  2   |    clk    |      1      |   输入    |                 时钟信号                 |
|  3   |  mem_wd   |      5      |   输入    | 访存阶段的指令最终要写入的目的寄存器地址 |
|  4   | mem_wreg  |      1      |   输入    | 访存阶段指令最终是否有要写入的目的寄存器 |
|  5   | mem_wdata |     32      |   输入    |  访存阶段的指令最终要写入目的寄存器的值  |
|  6   |   stall   |      6      |   输入    |       来自控制模块的信息，暂停信号       |
|  7   |   wb_wd   |      5      |   输出    |   回写阶段的指令要写入的目的寄存器地址   |
|  8   |  wb_wreg  |      1      |   输出    |  回写阶段的指令是否有要写入的目的寄存器  |
|  9   | wb_wdata  |     32      |   输出    |    回写阶段的指令要写入目的寄存器的值    |

​		MEM/WB模块中是时序逻辑电路，即在时钟上升沿才发生信号传递，而MEM模块中的是组合逻辑电路，MEM/WB模块将访存阶段指令是否要写目的寄存器mem_wreg、要写的目的寄存器地址mem_wd、要写入的数据mem_wdata等信息传递到回写阶段对应的接口 wb_wreg、wb_wd、wb_wdata。

---

## 数据存储器RAM

- 数据存储器RAM的接口描述，如表所示

| 序号 | 接口名 | 宽度（bit） | 输入/输出 |            作用             |
| :--: | :----: | :---------: | :-------: | :-------------------------: |
|  1   |  clk   |      1      |   输入    |          时钟信号           |
|  2   | data_i |     32      |   输入    |         要写的数据          |
|  3   |  addr  |     32      |   输入    |        要访问的地址         |
|  4   |   we   |      1      |   输入    | 是否是写操作，为1表示写操作 |
|  5   |   re   |      1      |   输入    | 是否是读操作，为1表示读操作 |
|  6   |  sel   |      4      |   输入    |        字节选择信号         |
|  7   |   ce   |      1      |   输入    |        芯片使能信号         |
|  8   | data_o |     32      |   输出    |         读出的数据          |

​		为了方便实现对数据存储器按字节寻址，在设计的时候使用4个8位存储器代替一个32位存储器。

- 在读操作时，从4个8位存储器中各读出一个字节，组合为一个32位的数据输出。

- 写操作时，依据sel的值，修改其中特定存储器对应的字节即可。

  ==注意==：地址addr的最低两位不需要使用。

---

## 指令存储器ROM

- 指令存储器ROM模块的接口描述

| 序号 | 接口名 | 宽度（bit） | 输入/输出 |       作用       |
| :--: | :----: | :---------: | :-------: | :--------------: |
|  1   |   ce   |      1      |   输入    |     使能信号     |
|  2   |  addr  |     32      |   输入    | 要读取的指令地址 |
|  3   |  inst  |     32      |   输出    |    读出的指令    |



---

## 顶层模块OpenMIPS的实现

- 顶层模块OpenMIPS中主要是对流水线中各个阶段的模块进行例化、连接。OpenMIPS模块的接口描述如下

| 序号 |   接口名   | 宽度（bit） | 输入/输出 |                   作用                    |
| :--: | :--------: | :---------: | :-------: | :---------------------------------------: |
|  1   |    rst     |      1      |   输入    |                 复位信号                  |
|  2   |    clk     |      1      |   输入    |                 时钟信号                  |
|  3   | rom_data_i |     32      |   输入    |          从指令存储器取得的指令           |
|  4   | rom_addr_o |     32      |   输出    |          输出到指令存储器的地址           |
|  5   |  rom_ce_o  |      1      |   输出    |            指令存储器使能信号             |
|  6   | ram_data_i |     32      |   输入    |          从数据存储器读取的数据           |
|  7   | ram_addr_o |     32      |   输出    |          要访问的数据存储器地址           |
|  8   |  ram_we_o  |      1      |   输出    | 是否对数据存储器的写操作，为1表示是写操作 |
|  9   |  ram_ce_o  |      1      |   输出    | 是否对数据存储器的读操作，为1表示是读操作 |
|  10  | ram_sel_o  |      4      |   输出    |               字节选择信号                |
|  11  | ram_data_o |     32      |   输出    |          要写入数据存储器的数据           |
|  12  |  ram_ce_o  |      1      |   输出    |            数据存储器使能信号             |
|  13  |   data_i   |     32      |   输入    |           来自IN单元的输入的数            |
|  14  |   data_o   |     32      |   输出    |             输出到OUT单元的数             |
|  15  |  io_we_o   |      1      |   输出    |         输入到IO单元的写使能信号          |
|  16  |  io_re_o   |      1      |   输出    |         输入到IO单元的读使能信号          |
|  17  |  enter_i   |      1      |   输入    |         来自外部的恢复流水级信号          |



---

## 最小SOPC的实现

- 为了验证，需要建立一个SOPC，其中仅含有OpenMIPS、指令存储器ROM、数据寄存器RAM，所以是一个最小SOPC。
- OpenMIPS从指令存储器ROM中读取指令，指令进入OpenMIPS开始执行。
- OpenMIPS从数据寄存器RAM中读取数据，数据进入OpenMIPS中存储到通用寄存器Regfile中。

- 最小SOPC的接口描述如下

| 序号 |   接口名    | 宽度（bit） | 输入/输出 |           作用           |
| :--: | :---------: | :---------: | :-------: | :----------------------: |
|  1   |     rst     |      1      |   输入    |         复位信号         |
|  2   |     clk     |      1      |   输入    |         时钟信号         |
|  3   |    enter    |      1      |   输入    | 来自外部的恢复流水级信号 |
|  4   | data_show_i |     32      |   输入    |    来自外部输入的数据    |
|  5   | data_show_o |     32      |   输出    |        输出到外部        |
|  6   |     pc      |     32      |   输出    |         指令地址         |
|  7   |    out_o    |      1      |   输出    |     输出数据显示使能     |

---

## IO单元

- 为了实现IN、OUT指令，加入IO单元，其接口描述如下。

| 序号 |   接口名    | 宽度（bit） | 输入/输出 |           作用            |
| :--: | :---------: | :---------: | :-------: | :-----------------------: |
|  1   |     rst     |      1      |   输入    |         复位信号          |
|  2   |     clk     |      1      |   输入    |         时钟信号          |
|  3   |     we      |      1      |   输入    | 写使能信号，为1表示可写入 |
|  4   |     re      |      1      |   输入    |  读使能信号，为1表示可读  |
|  5   |   data_i    |     32      |   输入    |    输出给OUT指令的数据    |
|  6   | data_show_i |     32      |   输入    |     来自于外部的数据      |
|  7   |   data_o    |     32      |   输出    |    输入给IN指令的数据     |
|  8   | data_show_o |     32      |   输出    |     将数据输出到外部      |
|  9   |     out     |      1      |   输出    |     输出数据显示使能      |

- IO单元读操作，从外部读取数据时是组合逻辑。
- IO单元写操作，将数据写出到外部是时序逻辑。

----

## CTRL模块

- 为了实现流水线的暂停，加入CTRL模块，其接口描述如下。IN指令需要暂停流水线，并且是在访存阶段实现的发出暂停请求。

| 序号 |      接口名       | 宽度（bit） | 输入/输出 |                 作用                 |
| :--: | :---------------: | :---------: | :-------: | :----------------------------------: |
|  1   |        rst        |      1      |   输入    |               复位信号               |
|  2   | stallreq_from_mem |      1      |   输入    | 处于访存阶段的指令是否请求流水线暂停 |
|  3   |       enter       |      1      |   输入    |  来自于外部的取消暂停，为1表示取消   |
|  4   |       stall       |      6      |   输出    |          暂停流水线控制信号          |

​		输出信号stall是一个宽度为6的信号，其含义如下。

- stall [0] 表示取指地址PC是否保持不变，为1表示保持不变。
- stall [1] 表示流水线取值阶段是否暂停，为1表示暂停。
- stall [2] 表示流水线译码阶段是否暂停，为1表示暂停。
- stall [3] 表示流水线执行阶段是否暂停，为1表示暂停。
- stall [4] 表示流水线访存阶段是否暂停，为1表示暂停。
- stall [5] 表示流水线回写阶段是否暂停，为1表示暂停。

----

## data_io模块

- data_io模块将当前PC地址输出到实验箱中，从实验箱中读取数据，并输出运算结果。其接口描述如下

| 序号 | 接口名 | 宽度（bit） | 输入/输出 |        作用        |
| :--: | :----: | :---------: | :-------: | :----------------: |
|  1   |  rst   |      1      |   输入    |      复位信号      |
|  2   |  clk   |      1      |   输入    |      时钟信号      |
|  3   | k1_ten |      1      |   输入    |      高位按键      |
|  4   | k2_ge  |      1      |   输入    |      低位按键      |
|  5   | out_i  |      1      |   输入    |    显示数据使能    |
|  6   | pc_in  |     32      |   输入    |       pc地址       |
|  7   |  res   |     32      |   输入    |    指令运算结果    |
|  8   |  data  |     32      |   输出    | 作为程序要读取的数 |
|  9   |  sel   |      3      |   输出    |        位选        |
|  10  |  seg   |      7      |   输出    |        段选        |

​		data_io模块，将pc地址取低8位，以16进制输出到两位数码管中。取实验箱中两位16进制数作为输入数据，并将运算结果作为16进制数输出。

---

## CPU模块

- 包含了sopc、data_io模块，其接口描述如下

| 序号 |  接口名  | 宽度（bit） | 输入/输出 |        作用        |
| :--: | :------: | :---------: | :-------: | :----------------: |
|  1   | CLOCK_50 |      1      |   输入    |      时钟信号      |
|  2   |   rst    |      1      |   输入    |      复位信号      |
|  3   |  enter   |      1      |   输入    | 取消流水级暂停信号 |
|  4   |    k1    |      1      |   输入    |      高位按键      |
|  5   |    k2    |      1      |   输入    |      低位按键      |
|  6   |   sel    |      3      |   输出    |      位选信号      |
|  7   |   seg    |      8      |   输出    |      段选信号      |





